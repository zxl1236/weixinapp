# æ‰¹é‡éŸ³é¢‘ç”Ÿæˆéƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–¹æ¡ˆä½¿ç”¨è…¾è®¯äº‘ TTS + COS æ‰¹é‡ç”Ÿæˆæ‰€æœ‰å¹´çº§çš„éŸ³é¢‘æ–‡ä»¶ï¼Œå°ç¨‹åºç«¯ä¼˜å…ˆä½¿ç”¨é¢„ç”ŸæˆéŸ³é¢‘ï¼Œå›é€€åˆ°å®æ—¶ TTSã€‚

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. ç¯å¢ƒå‡†å¤‡

#### å®‰è£…ä¾èµ–
```bash
cd scripts
npm install tencentcloud-sdk-nodejs cos-nodejs-sdk-v5
```

#### ç¯å¢ƒå˜é‡é…ç½®
åˆ›å»º `.env` æ–‡ä»¶ï¼š
```bash
# è…¾è®¯äº‘ TTS é…ç½®
TENCENT_SECRET_ID=your_tencent_secret_id
TENCENT_SECRET_KEY=your_tencent_secret_key

# è…¾è®¯äº‘ COS é…ç½®
COS_SECRET_ID=your_cos_secret_id
COS_SECRET_KEY=your_cos_secret_key
COS_BUCKET=your-bucket-name
COS_REGION=ap-beijing

# CDN é…ç½®
CDN_DOMAIN=https://cdn.yourdomain.com
```

### 2. æ•°æ®æå–

```bash
# æå–è¯æ±‡æ•°æ®
node scripts/extractWordsData.js

# è¾“å‡ºæ–‡ä»¶ï¼š
# - scripts/extracted_data/words_data.json
# - scripts/extracted_data/audio_url_map.json
```

### 3. æ‰¹é‡ç”ŸæˆéŸ³é¢‘

```bash
# æ‰¹é‡ç”Ÿæˆæ‰€æœ‰å¹´çº§çš„éŸ³é¢‘æ–‡ä»¶
node scripts/batchAudioGenerator.js

# è¾“å‡ºæ–‡ä»¶ï¼š
# - scripts/audio_output/generation_report.json
# - scripts/audio_output/audio_url_map.json
# - scripts/audio_output/grade3/*.mp3
# - scripts/audio_output/grade4/*.mp3
# - ...
```

### 4. å°ç¨‹åºé…ç½®

#### ä¿®æ”¹ CDN åŸŸå
åœ¨ `pages/learning/learning.js` ä¸­ä¿®æ”¹ï¼š
```javascript
// æ„å»ºCDN URL
const cdnDomain = 'https://your-actual-cdn-domain.com'; // æ›¿æ¢ä¸ºå®é™…CDNåŸŸå
```

#### å¯é€‰ï¼šä½¿ç”¨éŸ³é¢‘URLç”Ÿæˆå™¨
```javascript
// åœ¨é¡µé¢é¡¶éƒ¨å¼•å…¥
const { AudioUrlGenerator, AudioPlaybackManager } = require('../../utils/audioUrlGenerator.js');

// åœ¨é¡µé¢åˆå§‹åŒ–æ—¶åˆ›å»ºå®ä¾‹
onLoad() {
  this.audioManager = new AudioPlaybackManager({
    cdnDomain: 'https://your-cdn-domain.com',
    enablePreGeneratedAudio: true
  });
}

// ä½¿ç”¨æ–°çš„æ’­æ”¾æ–¹æ³•
async playWord(word) {
  const grade = this.data.currentGrade || 'grade3';
  await this.audioManager.playWord(word, grade, this.ensureTTSReady.bind(this));
}
```

## ğŸ“Š é¢„æœŸç»“æœ

### éŸ³é¢‘æ–‡ä»¶ç»“æ„
```
https://cdn.yourdomain.com/audio/
â”œâ”€â”€ grade3/
â”‚   â”œâ”€â”€ name.mp3
â”‚   â”œâ”€â”€ ear.mp3
â”‚   â”œâ”€â”€ hand.mp3
â”‚   â””â”€â”€ ...
â”œâ”€â”€ grade4/
â”‚   â”œâ”€â”€ apple.mp3
â”‚   â”œâ”€â”€ book.mp3
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

### æ€§èƒ½æå‡
- **åŠ è½½é€Ÿåº¦**ï¼šé¢„ç”ŸæˆéŸ³é¢‘ < 100msï¼Œå®æ—¶TTS > 2s
- **æˆåŠŸç‡**ï¼šé¢„ç”ŸæˆéŸ³é¢‘ 99%+ï¼Œå®æ—¶TTS 80-90%
- **ç”¨æˆ·ä½“éªŒ**ï¼šæ— ç­‰å¾…æ—¶é—´ï¼Œæ’­æ”¾æµç•…

## ğŸ”§ é…ç½®é€‰é¡¹

### éŸ³é¢‘ç”Ÿæˆé…ç½®
```javascript
const audioConfig = {
  ModelType: 1,        // åŸºç¡€æ¨¡å‹
  Volume: 1,          // éŸ³é‡
  VoiceType: 101001,  // è‹±æ–‡å¥³å£°
  SampleRate: 16000,  // é‡‡æ ·ç‡
  Codec: "mp3",       // éŸ³é¢‘æ ¼å¼
  Speed: 1.0,         // è¯­é€Ÿ
};
```

### å°ç¨‹åºç«¯é…ç½®
```javascript
const config = {
  cdnDomain: 'https://cdn.yourdomain.com',
  audioPath: 'audio',
  enablePreGeneratedAudio: true,
  gradeMapping: {
    'grade3': 'grade3',
    'grade4': 'grade4',
    // ...
  }
};
```

## ğŸ“ˆ ç›‘æ§å’Œç»´æŠ¤

### ç”ŸæˆæŠ¥å‘Š
æ¯æ¬¡æ‰¹é‡ç”Ÿæˆåä¼šç”Ÿæˆ `generation_report.json`ï¼š
```json
{
  "timestamp": "2025-01-XX",
  "totalWords": 1500,
  "successCount": 1480,
  "failCount": 20,
  "successRate": "98.67%",
  "results": {
    "grade3": [...],
    "grade4": [...]
  }
}
```

### ç¼“å­˜ç®¡ç†
å°ç¨‹åºç«¯ä¼šè‡ªåŠ¨ç¼“å­˜URLæ˜ å°„ï¼Œå‡å°‘é‡å¤è¯·æ±‚ï¼š
```javascript
// æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
console.log(this.audioManager.urlGenerator.getCacheStats());

// æ¸…ç©ºç¼“å­˜
this.audioManager.urlGenerator.clearCache();
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **CDNåŸŸå**ï¼šç¡®ä¿CDNåŸŸåå·²æ­£ç¡®é…ç½®CORS
2. **æ–‡ä»¶æƒé™**ï¼šç¡®ä¿COSå­˜å‚¨æ¡¶å…è®¸å…¬å¼€è¯»å–
3. **APIé™åˆ¶**ï¼šè…¾è®¯äº‘TTSæœ‰è°ƒç”¨é¢‘ç‡é™åˆ¶ï¼Œå»ºè®®åˆ†æ‰¹å¤„ç†
4. **å­˜å‚¨æˆæœ¬**ï¼šé¢„ä¼°å­˜å‚¨æˆæœ¬ï¼Œå®šæœŸæ¸…ç†ä¸éœ€è¦çš„éŸ³é¢‘æ–‡ä»¶
5. **å›é€€æœºåˆ¶**ï¼šå§‹ç»ˆä¿æŒTTSä½œä¸ºå›é€€æ–¹æ¡ˆ

## ğŸ”„ æ›´æ–°æµç¨‹

å½“è¯æ±‡æ•°æ®æ›´æ–°æ—¶ï¼š
1. æ›´æ–° `preprocessedWordDatabase.js`
2. é‡æ–°è¿è¡Œæ•°æ®æå–è„šæœ¬
3. æ‰¹é‡ç”Ÿæˆæ–°å¢è¯æ±‡çš„éŸ³é¢‘
4. æ›´æ–°CDNæ–‡ä»¶
5. å°ç¨‹åºç«¯è‡ªåŠ¨ä½¿ç”¨æ–°éŸ³é¢‘

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®
2. è…¾è®¯äº‘APIæƒé™æ˜¯å¦å……è¶³
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. CDNé…ç½®æ˜¯å¦æ­£ç¡®
