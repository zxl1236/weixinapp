# 微信支付配置指南

## 🔧 配置步骤

### 1. 获取微信小程序配置信息

1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入您的小程序后台
3. 在"设置" -> "基本设置"中找到 `AppID`

### 2. 申请微信支付商户号

1. 访问 [微信支付商户平台](https://pay.weixin.qq.com/)
2. 申请成为微信支付商户
3. 获取 `商户号(mch_id)` 和 `API密钥`

### 3. 配置支付参数

在 `utils/paymentService.js` 文件中，修改以下配置：

```javascript
const PAYMENT_CONFIG = {
  isDevelopment: false, // 设为false启用真实支付
  apiBaseUrl: 'https://your-domain.com/api', // 您的后端API地址
  merchantInfo: {
    appId: 'wx1234567890abcdef', // 替换为您的小程序AppID
    mchId: '1234567890'         // 替换为您的微信支付商户号
  }
};
```

### 4. 后端API接口

您的后端需要提供以下接口：

#### 4.1 获取支付参数
```
POST /api/payment/get-params
```

请求参数：
```json
{
  "orderId": "ORDER_1234567890_1234",
  "planId": "1",
  "amount": 1990,
  "openid": "user_openid"
}
```

响应格式：
```json
{
  "success": true,
  "data": {
    "timeStamp": "1234567890",
    "nonceStr": "random_string",
    "package": "prepay_id=wx1234567890",
    "signType": "MD5",
    "paySign": "signature_string"
  }
}
```

#### 4.2 支付完成通知
```
POST /api/payment/complete
```

### 5. 小程序配置

在 `app.json` 中确保添加了支付权限：

```json
{
  "permission": {
    "scope.userInfo": {
      "desc": "获取用户信息"
    }
  },
  "requiredBackgroundModes": [
    "audio"
  ]
}
```

### 6. 测试支付流程

1. 确保所有配置正确
2. 在真机上测试支付功能
3. 检查支付成功后的会员权限更新

## 🚨 重要提示

1. **安全性**：API密钥等敏感信息不应存储在小程序端
2. **签名**：所有支付参数必须在后端进行签名
3. **验证**：支付完成后需要验证支付结果的真实性
4. **测试**：建议先在沙箱环境进行测试

## 📞 技术支持

如果在配置过程中遇到问题，可以：

1. 查看微信官方文档：[小程序支付接入指南](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/payment.html)
2. 检查配置参数是否正确
3. 查看控制台错误信息
4. 联系技术支持团队

## 📝 配置检查清单

- [ ] 小程序AppID已配置
- [ ] 微信支付商户号已配置  
- [ ] 后端API地址已配置
- [ ] 支付参数获取接口已实现
- [ ] 支付完成通知接口已实现
- [ ] 在真机上测试支付流程
- [ ] 验证支付成功后权限更新

配置完成后，用户点击"立即支付"按钮将会跳转到微信支付页面完成付款。
