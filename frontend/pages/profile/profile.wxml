<!-- pages/profile/profile.wxml -->
<view class="profile-page">
  <!-- æˆæƒå¼¹çª— -->
  <view class="auth-modal" wx:if="{{showAuthModal}}">
    <view class="auth-overlay" bindtap="closeAuthModal"></view>
    <view class="auth-content">
      <view class="auth-header">
        <view class="auth-icon">ğŸ‘¤</view>
        <view class="auth-title">å®Œå–„ä¸ªäººä¿¡æ¯</view>
        <view class="auth-desc">æˆæƒè·å–æ‚¨çš„æ˜µç§°å’Œå¤´åƒï¼Œä¸ºæ‚¨æä¾›æ›´å¥½çš„ä¸ªæ€§åŒ–å­¦ä¹ ä½“éªŒ</view>
      </view>
      <view class="auth-buttons">
        <button class="auth-btn auth-btn-primary" bindtap="onGetUserProfile">
          ä½¿ç”¨å¾®ä¿¡å¤´åƒå’Œæ˜µç§°
        </button>
        <button class="auth-btn auth-btn-secondary" bindtap="closeAuthModal">
          ç¨åå†è¯´
        </button>
      </view>
    </view>
  </view>

  <view class="profile-container">

    <!-- ç”¨æˆ·å¡ç‰‡ -->
    <view class="user-card">
      <view class="user-header">
        <view class="avatar-section">
          <!-- å¤´åƒé€‰æ‹©æŒ‰é’®ï¼ˆæ–°APIï¼šchooseAvatarï¼‰ -->
          <button class="avatar-button" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
            <view class="user-avatar">
              <image src="{{userInfo.avatar || userInfo.avatarUrl || defaultAvatar}}" class="avatar-img" mode="aspectFill"></image>
              <view class="avatar-edit-icon">ğŸ“·</view>
            </view>
          </button>
          <text class="avatar-tip" style="position: relative; left: -102rpx; top: 31rpx">ç‚¹å‡»å›¾ç‰‡æ›´æ¢å¤´åƒ</text>
        </view>
        
        <view class="user-info" style="position: relative; left: -44rpx; top: 1rpx">
          <!-- æ˜µç§°è¾“å…¥ï¼ˆæ–°APIï¼štype="nickname"ï¼‰ -->
          <view class="nickname-wrapper">
            <input 
              class="user-name-input" 
              type="nickname" 
              placeholder="è¯·è¾“å…¥æ˜µç§°"
              value="{{userInfo.nickname || userInfo.nickName || ''}}"
              bindchange="onInputChange"
              bindblur="onNicknameBlur"
              maxlength="20"
            />
          </view>
          <text class="user-desc">{{hasUserInfo ? 'ç»§ç»­åŠ æ²¹å­¦ä¹ å§ï¼' : 'è¯·è®¾ç½®å¤´åƒå’Œæ˜µç§°'}}</text>
          <text class="user-id" wx:if="{{userInfo.id}}">IDï¼š{{userInfo.id}}</text>
          <!-- ä¿å­˜å¹¶åŒæ­¥æŒ‰é’® -->
          <button 
            class="submit-button" 
            type="primary"
            bindtap="submitUserInfo"
            style="position: relative; left: -9rpx; top: 12rpx; margin-top: 16rpx;">
            ä¿å­˜å¹¶åŒæ­¥
          </button>
        </view>
      </view>
    </view>

  <!-- å­¦ä¹ ç»Ÿè®¡ -->
    <view class="section">
    
      
      <!-- æ€»è¿›åº¦æ˜¾ç¤º -->
      <view class="stats-group">
        
        <view class="stats-capsule">
          
          <view class="divider"></view>
          
        </view>
      </view>
      
      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="stats-group">
        <view class="stats-group-title">å½“å‰å¹´çº§</view>
        <view class="stats-capsule">
          <view class="cap">
            <text class="cap-num">{{studyStats.currentGradeWords || 0}}</text>
            <text class="cap-label">å¹´çº§è¯æ±‡é‡</text>
          </view>
          <view class="divider"></view>
          <view class="cap">
            <text class="cap-num">{{studyStats.currentGradeMastered || 0}}</text>
            <text class="cap-label">å¹´çº§æŒæ¡</text>
          </view>
          <view class="divider"></view>
          <view class="cap">
            <text class="cap-num">{{studyStats.studyDays || 0}}</text>
            <text class="cap-label">å­¦ä¹ å¤©æ•°</text>
      </view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
    <view class="section">
    <view class="section-title">åŠŸèƒ½èœå•</view>
    <view class="menu-list">
        <block wx:for="{{menuItems}}" wx:key="index">
      <view 
        class="menu-item"
        data-url="{{item.url}}"
        bindtap="navigateToPage"
        hover-class="menu-item-press"
      >
        <view class="menu-icon">
          <image src="{{item.icon}}" class="icon-img" mode="aspectFit"></image>
        </view>
        <view class="menu-content">
          <text class="menu-title">{{item.title}}</text>
          <text class="menu-subtitle">{{item.subtitle}}</text>
        </view>
            <text class="menu-arrow">â€º</text>
        </view>
        </block>
      </view>
    </view>

  </view>
</view>
