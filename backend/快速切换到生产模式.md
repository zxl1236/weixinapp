# 快速切换到生产模式

## 🚀 一键切换脚本

在服务器上运行以下命令：

```bash
cd /var/www/k12-backend/backend
chmod +x 切换到生产模式.sh
./切换到生产模式.sh
```

脚本会自动：
1. 备份当前 `.env` 文件
2. 将 `NODE_ENV` 设置为 `production`
3. 运行配置检查
4. 显示下一步操作提示

## 📝 手动切换步骤

### 1. 修改环境变量

编辑 `.env` 文件：

```bash
nano /var/www/k12-backend/backend/.env
```

将 `NODE_ENV` 改为 `production`：

```bash
NODE_ENV=production
```

### 2. 验证配置

```bash
cd /var/www/k12-backend/backend
node check-config.js
```

确保所有检查项都通过，特别是：
- ✅ 环境: production (生产模式)
- ✅ 当前为生产模式，将使用真实微信支付

### 3. 重启服务

```bash
# 如果使用 PM2
pm2 restart k12-backend

# 如果使用 systemd
systemctl restart k12-backend

# 如果直接运行，先停止（Ctrl+C），然后：
node server.js
```

### 4. 验证服务状态

查看日志，确认：
- ✅ 没有 "开发模式" 警告
- ✅ 显示 "微信支付初始化成功"
- ✅ 环境为 production

```bash
# PM2
pm2 logs k12-backend

# 或查看日志文件
tail -f /var/www/k12-backend/backend/logs/app.log
```

## ⚠️ 重要提示

1. **生产模式要求：**
   - 必须配置完整的微信支付参数（AppID、商户号、API密钥）
   - 必须上传微信支付证书文件到 `certs/` 目录
   - 必须在微信商户平台配置支付回调URL

2. **证书文件：**
   - 从微信商户平台下载证书
   - 上传到服务器 `backend/certs/` 目录
   - 设置文件权限：`chmod 600 certs/*.pem`

3. **回调URL：**
   - 必须是 HTTPS 地址
   - 格式：`https://你的域名.com/api/payment/notify`
   - 在微信商户平台配置

## 📚 详细文档

更多详细信息，请查看：[生产环境部署指南.md](./生产环境部署指南.md)

