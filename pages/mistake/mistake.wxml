<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <view class="header-top">
      <view class="back-btn" bindtap="goBack">
        <text class="back-icon">â†</text>
        <text class="back-text">è¿”å›</text>
      </view>
      
      <view class="placeholder"></view>
    </view>
    <view class="subtitle" wx:if="{{!isEmpty}}">å…±æ”¶å½• {{mistakes.length}} ä¸ªç”Ÿè¯</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-text">æ­£åœ¨åŠ è½½ç”Ÿè¯...</view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-container" wx:if="{{isEmpty && !loading}}">
    <view class="empty-icon">ğŸ‰</view>
    <view class="empty-title">æš‚æ— ç”Ÿè¯</view>
    <view class="empty-desc">ç»§ç»­å­¦ä¹ ï¼Œç”Ÿè¯ä¼šè‡ªåŠ¨æ”¶å½•åˆ°è¿™é‡Œ</view>
    <view class="empty-actions">
      <button class="btn btn-primary" bindtap="goToTest">å¼€å§‹æµ‹è¯•</button>
      <button class="btn btn-secondary" bindtap="addTestWords">æ·»åŠ ç”Ÿè¯</button>
    </view>
  </view>

  <!-- ç”Ÿè¯åˆ—è¡¨ -->
  <view class="mistakes-list" wx:if="{{!isEmpty && !loading}}">
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="btn btn-primary" bindtap="reviewWords">
        ğŸ”„ å¤ä¹ ç”Ÿè¯ ({{unmasteredCount}})
      </button>
      <button class="btn btn-secondary" bindtap="clearWords">
        ğŸ—‘ï¸ æ¸…ç©ºç”Ÿè¯æœ¬
      </button>
    </view>

    <!-- ç”Ÿè¯å¡ç‰‡ -->
    <view class="mistake-card" wx:for="{{mistakes}}" wx:key="word" data-index="{{index}}" bindtap="showWordDetail">
      <view class="mistake-header">
        <view class="word-info">
          <view class="mistake-word">{{item.word}}</view>
          <view class="mistake-level">Level {{item.level}}</view>
        </view>
        <view class="mistake-status">
          <view class="error-count">å­¦ä¹  {{item.errorCount}} æ¬¡</view>
          <view class="mastered-badge" wx:if="{{item.mastered}}">âœ… å·²æŒæ¡</view>
        </view>
      </view>
      
      <view class="mistake-content">
        <view class="correct-answer">
          <text class="label">ä¸­æ–‡æ„æ€ï¼š</text>
          <text class="answer">{{item.correctAnswer}}</text>
        </view>
        <view class="last-error">
          <text class="label">æœ€è¿‘å­¦ä¹ ï¼š</text>
          <text class="time">{{item.lastErrorTimeStr}}</text>
        </view>
      </view>

      <view class="mistake-actions">
        <button class="action-btn mastered-btn" wx:if="{{!item.mastered}}" 
                data-index="{{index}}" bindtap="markAsMastered" catchtap="">
          æ ‡è®°å·²æŒæ¡
        </button>
      </view>
    </view>
  </view>
</view>

<!-- ç”Ÿè¯è¯¦æƒ…å¼¹çª— -->
<view class="modal-mask" wx:if="{{showDetail}}" catchtap="closeWordDetail">
  <view class="modal-container detail-modal" catchtap="">
    <view class="modal-header">
      <view class="modal-title">ğŸ“ ç”Ÿè¯è¯¦æƒ…</view>
      <view class="close-btn" bindtap="closeWordDetail">âœ•</view>
    </view>
    
    <view class="modal-body" wx:if="{{currentMistake}}">
      <view class="detail-word">
        <view class="word-main">{{currentMistake.word}}</view>
        <view class="word-phonetic" wx:if="{{currentMistake.phonetic}}">{{currentMistake.phonetic}}</view>
        <view class="word-level">Level {{currentMistake.level}}</view>
        <button class="word-pronunciation-btn" bindtap="playWordPronunciation" data-word="{{currentMistake.word}}" data-phonetic="{{currentMistake.phonetic}}">
          ğŸ”Š å¬å‘éŸ³
        </button>
      </view>
      
      <view class="detail-answer">
        <view class="detail-label">ä¸­æ–‡æ„æ€</view>
        <view class="detail-value correct">{{currentMistake.correctAnswer}}</view>
      </view>

      <view class="error-stats">
        <view class="stat-item">
          <view class="stat-label">å­¦ä¹ æ¬¡æ•°</view>
          <view class="stat-value">{{currentMistake.errorCount}} æ¬¡</view>
        </view>
        <view class="stat-item">
          <view class="stat-label">é¦–æ¬¡å­¦ä¹ </view>
          <view class="stat-value">{{currentMistake.firstErrorTimeStr}}</view>
        </view>
      </view>

      <view class="error-history" wx:if="{{currentMistake.errorHistory.length > 0}}">
        <view class="detail-label">å­¦ä¹ å†å²</view>
        <view class="history-item" wx:for="{{currentMistake.errorHistory}}" wx:key="timestamp">
          <view class="history-answer">å­¦ä¹ äº†ï¼š{{item.selectedAnswer}}</view>
          <view class="history-time">{{item.timeStr}}</view>
        </view>
      </view>
    </view>

    <view class="modal-footer">
      <button class="btn btn-secondary" bindtap="closeWordDetail">å…³é—­</button>
      <button class="btn btn-primary" wx:if="{{currentMistake && !currentMistake.mastered}}" 
              data-index="{{currentMistakeIndex}}" bindtap="markAsMastered">
        æ ‡è®°å·²æŒæ¡
      </button>
    </view>
  </view>
</view>