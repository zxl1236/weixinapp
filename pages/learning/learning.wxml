<view class="learning-container" style="position: relative; left: 0rpx; top: 0rpx">

  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="modern-header" style="height: 66rpx; display: block; box-sizing: border-box; background: #f4f5f7 !important; left: 0rpx; top: 0rpx">
    <view class="header-left" style="width: 141rpx; display: flex; box-sizing: border-box; position: relative; left: 233rpx; top: -1rpx">
      <button class="back-btn" bindtap="goBack" style="position: relative; left: -195rpx; top: -1rpx">
        <text class="back-icon">â†</text>
      </button>
    </view>
    <view class="header-center">
  
    </view>
    <view class="header-right" style="height: 0rpx; display: flex; box-sizing: border-box">
      <button class="header-icon-btn" bindtap="showMenuOptions" style="position: relative; left: 10rpx; top: -18rpx; width: 345rpx; height: 60rpx; display: flex; box-sizing: border-box">
        <text class="icon-text">â‹¯</text>
      </button>
      <button class="header-icon-btn" bindtap="pauseLearning" wx:if="{{!isPaused}}" style="position: relative; left: -229rpx; top: -43rpx">
        <text class="icon-text" style="width: 81rpx; height: 79rpx; display: block; box-sizing: border-box; position: relative; left: 29rpx; top: 29rpx">â¸</text>
      </button>
      <button class="header-icon-btn" bindtap="resumeLearning" wx:if="{{isPaused}}">
        <text class="icon-text">â–¶</text>
      </button>
    </view>
  </view>
  
  <!-- å­¦ä¹ çŠ¶æ€ä¿¡æ¯ -->
  <view class="learning-status">
    <view class="status-left" style="position: relative; left: -2rpx; top: 33rpx">
      <text class="phase-label" style="position: relative; left: 0rpx; top: -18rpx">{{phaseLabel}}</text>
    </view>
    <view class="status-right" style="position: relative; left: -1rpx; top: 31rpx">
      <text class="word-progress">å•è¯ {{currentWordIndex + 1}}/{{currentGroupWords.length}}</text>
    </view>
  </view>

  <!-- è¿›åº¦æ¡ -->
  <view class="progress-container">
    <view class="progress-bar" style="{{'width: ' + progress.percentage + '%'}}"></view>
  </view>
  
  <!-- æš‚åœçŠ¶æ€æç¤º -->
  <view class="pause-notice" wx:if="{{isPaused}}">
    <text class="pause-text">â¸ï¸ å­¦ä¹ å·²æš‚åœï¼Œç‚¹å‡»"æ¢å¤"ç»§ç»­å­¦ä¹ </text>
  </view>

  <!-- ====== è®¤è¯†é˜¶æ®µè®­ç»ƒç•Œé¢ ====== -->
  <view wx:if="{{phase === 'phase0' && currentWord}}" class="main-content">
    <view class="modern-word-card" style="position: relative; left: -1rpx; top: 31rpx">
      
      <!-- å•è¯ä¸»ä½“åŒºåŸŸ -->
      <view class="word-main-section">
        <view class="word-display">
          <text class="word-text">{{currentWord.word}}</text>
          <text class="phonetic-text" wx:if="{{currentWord.phonetic}}">[{{currentWord.phonetic}}]</text>
        </view>
        
        <!-- å‘éŸ³æŒ‰é’® -->
        <button class="modern-pronunciation-btn {{isPlaying ? 'playing' : ''}}" 
                bindtap="playCurrentWordPronunciation" 
                disabled="{{isPlaying}}">
          <text class="pronunciation-icon">ğŸ”Š</text>
          <text class="pronunciation-label">{{isPlaying ? 'æ’­æ”¾ä¸­...' : 'å¬å‘éŸ³'}}</text>
        </button>
      </view>

      <!-- å•è¯ä¿¡æ¯å¡ç‰‡ -->
      <view class="word-info-card">
        <view class="word-type-badge" wx:if="{{currentWord.wordType}}">
          <text class="type-text" style="position: relative; left: -228rpx; top: 31rpx">{{currentWord.wordType === 'noun' ? 'åè¯' : 
                                   currentWord.wordType === 'verb' ? 'åŠ¨è¯' : 
                                   currentWord.wordType === 'adjective' ? 'å½¢å®¹è¯' : 
                                   currentWord.wordType === 'phrase' ? 'çŸ­è¯­' : 'æœªçŸ¥'}}</text>
        </view>
        <view class="word-meaning-text" style="position: relative; left: -1rpx; top: -46rpx">{{currentWord.meaning}}</view>
      </view>

      <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
      <view class="action-buttons">
        <button class="modern-btn mastered-btn" bindtap="markAsMastered" disabled="{{isProcessing}}">
          <text class="btn-icon">âœ“</text>
          <text class="btn-label">ä¼šè®¤ä¼šè¯»</text>
        </button>
        <button class="modern-btn practice-btn" bindtap="markAsNeedLearning" disabled="{{isProcessing}}">
          <text class="btn-icon">?</text>
          <text class="btn-label">ä¸ç†Ÿæ‚‰ï¼Œéœ€è¦ç»ƒä¹ </text>
        </button>
      </view>

      <!-- è¿›åº¦æŒ‡ç¤º -->
      <view class="progress-indicator">
        <text class="progress-text">å•è¯ {{recognitionDone}}/{{currentGroupWords.length}}</text>
      </view>
      
    </view>
  </view>

  <!-- ====== è¿‡æ»¤ç»“æœç»Ÿè®¡ç•Œé¢ ====== -->
  <view wx:if="{{showFilterResult}}">
    <view class="filter-result-container">
      <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
      <view class="progress-indicator">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{(currentGroup / totalGroups) * 100}}%"></view>
        </view>
        <view class="progress-text">ç¬¬ {{currentGroup}} / {{totalGroups}} ç»„</view>
      </view>
      
      <!-- æ ‡é¢˜ -->
      <view class="result-title">
        <text class="title-text">ç¬¬{{currentGroup}}ç»„è¿‡æ»¤å®Œæˆ</text>
        <text class="subtitle-text">æŸ¥çœ‹ä½ çš„æŒæ¡æƒ…å†µ</text>
      </view>

      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <view class="stats-cards">
        <view class="stat-card mastered-card" style="width: 310rpx; height: 262rpx; display: flex; box-sizing: border-box; left: -162rpx; top: -17rpx; position: relative">
          <view class="stat-number">{{masteredCount}}</view>
          <view class="stat-label" style="font-weight: 100;">æœ¬ç»„å·²æŒæ¡</view>
          <view class="stat-subtitle">ç´¯è®¡: {{accumulatedMasteredCount}}</view>
          <view class="stat-icon">âœ…</view>
        </view>
        <view class="stat-card learning-card" style="width: 224rpx; height: 210rpx; display: flex; box-sizing: border-box; left: 179rpx; top: -329rpx; position: relative">
          <view class="stat-number">{{needLearningCount}}</view>
          <view class="stat-label" style="font-weight: 100;">æœ¬ç»„éœ€å­¦ä¹ </view>
          <view class="stat-subtitle">ç´¯è®¡: {{accumulatedNeedLearningCount}}</view>
          <view class="stat-icon">ğŸ“š</view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="result-actions">
        <button class="action-btn continue-btn" bindtap="continueToNextGroup" wx:if="{{currentGroup < totalGroups}}" style="position: relative; left: -8rpx; top: -408rpx; width: 420rpx; height: 152rpx; display: flex; box-sizing: border-box">
          <text class="btn-icon">â¡ï¸</text>
          <text class="btn-text" style="width: 229rpx; display: block; box-sizing: border-box">ç»§ç»­è¿‡æ»¤ä¸‹ä¸€ç»„</text>
        </button>
        <button class="action-btn start-learning-btn" bindtap="startLearningUnfamiliarWords" wx:if="{{accumulatedNeedLearningCount > 0}}" style="position: relative; left: -8rpx; top: -396rpx; width: 420rpx; height: 152rpx; display: flex; box-sizing: border-box">
          <text class="btn-icon">ğŸ“š</text>
          <text class="btn-text" style="width: 229rpx; display: block; box-sizing: border-box;">å¼€å§‹å­¦ä¹ ä¸ä¼šçš„ ({{accumulatedNeedLearningCount}}ä¸ª)</text>
        </button>
        <button class="action-btn finish-btn" bindtap="finishFiltering" wx:if="{{accumulatedNeedLearningCount === 0}}">
          <text class="btn-icon">ğŸ‰</text>
          <text class="btn-text">å…¨éƒ¨æŒæ¡ï¼Œå®Œæˆå­¦ä¹ </text>
        </button>
      </view>
    </view>
  </view>

  <!-- ====== å­¦ä¹ ç•Œé¢ ====== -->
  <view wx:if="{{(phase === 'phase1' || phase === 'phase2') && currentWord}}" class="main-content">
    <view class="modern-word-card learning-card">
      
      <!-- å•è¯ä¸»ä½“åŒºåŸŸ -->
      <view class="word-main-section" style="position: relative; left: -2rpx; top: 54rpx">
        <view class="word-display">
          <text class="word-text" style="position: relative; left: 0rpx; top: 35rpx">{{currentWord.word}}</text>
          <text class="phonetic-text" wx:if="{{currentWord.phonetic}}" style="position: relative; left: 0rpx; top: 74rpx">[{{currentWord.phonetic}}]</text>
        </view>
        
        <!-- å‘éŸ³æŒ‰é’® -->
        <button class="modern-pronunciation-btn {{isPlaying ? 'playing' : ''}}" 
                bindtap="playCurrentWordPronunciation" 
                disabled="{{isPlaying}}" style="position: relative; left: -4rpx; top: 75rpx">
          <text class="pronunciation-icon">ğŸ”Š</text>
          <text class="pronunciation-label">{{isPlaying ? 'æ’­æ”¾ä¸­...' : 'å¬å‘éŸ³'}}</text>
        </button>
      </view>

      <!-- å•è¯ä¿¡æ¯å¡ç‰‡ -->
      <view class="word-info-card" style="position: relative; left: 4rpx; top: 147rpx">
        <view class="word-type-badge" wx:if="{{currentWord.wordType}}">
          <text class="type-text" style="position: relative; left: -199rpx; top: 36rpx">{{currentWord.wordType === 'noun' ? 'åè¯' : 
                                   currentWord.wordType === 'verb' ? 'åŠ¨è¯' : 
                                   currentWord.wordType === 'adjective' ? 'å½¢å®¹è¯' : 
                                   currentWord.wordType === 'phrase' ? 'çŸ­è¯­' : 'æœªçŸ¥'}}</text>
        </view>
        <view class="word-meaning-text" style="position: relative; left: 25rpx; top: -39rpx">{{currentWord.meaning}}</view>
      </view>

      <!-- ç¬¬ä¸€é˜¶æ®µï¼šè·Ÿè¯»ç»ƒä¹  -->
      <view class="practice-section" wx:if="{{currentPhase === 1}}">
        <view class="practice-header">
          <text class="practice-title" style="position: relative; left: -1rpx; top: -556rpx">ğŸ¤ è·Ÿè¯»ç»ƒä¹ </text>
          <text class="practice-subtitle" style="position: relative; left: -2rpx; top: -550rpx">å¬å‘éŸ³ï¼Œè·Ÿè¯»å•è¯ï¼ŒåŠ æ·±è®°å¿†</text>
        </view>
        <view class="practice-actions">
          <button class="modern-btn secondary-btn" bindtap="playCurrentWordPronunciation" style="width: 168rpx; display: flex; box-sizing: border-box; left: 0rpx; top: 0rpx">
            <text class="btn-icon">ğŸ”Š</text>
            <text class="btn-label">å¬å‘éŸ³</text>
          </button>
          <button class="modern-btn primary-btn" bindtap="markAsUnderstood">
            <text class="btn-icon">âœ“</text>
            <text class="btn-label">ç»§ç»­ä¸‹ä¸€ä¸ª</text>
          </button>
        </view>
      </view>

      <!-- ç¬¬äºŒé˜¶æ®µï¼šå·©å›ºç»ƒä¹  -->
      <view class="practice-section" wx:if="{{currentPhase === 2}}">
        <view class="practice-header">
          <text class="practice-title">ğŸ¯ å·©å›ºç»ƒä¹ </text>
          <text class="practice-subtitle">è¿™ä¸ªå•è¯çš„å«ä¹‰æ˜¯ï¼Ÿ</text>
        </view>
        <view class="choice-options">
          <view class="modern-option {{selectedAnswer===item?'selected':''}} {{choiceCorrect && selectedAnswer===item?'correct':''}} {{selectedAnswer===item && !choiceCorrect?'wrong':''}} {{isProcessing?'disabled':''}}"
                wx:for="{{choiceOptions}}" wx:key="*this"
                data-answer="{{item}}" bindtap="{{isProcessing?'':'selectChoice'}}">
            <text class="option-text">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
      <view class="bottom-actions">
        <button class="modern-btn outline-btn" bindtap="skipWord">è·³è¿‡</button>
        <button class="modern-btn outline-btn" bindtap="pauseLearning">æš‚åœ</button>
      </view>
    </view>
  </view>

  <!-- ====== è¯æ€§åˆ†ç±»è®­ç»ƒç•Œé¢ ====== -->
  <view wx:if="{{phase === 'wordType' && currentWord}}">
    <view class="word-card wordtype-card">
      <!-- æ ¸å¿ƒå•è¯åŒºåŸŸ -->
      <view class="word-core-section">
        <view class="word-main">{{currentWord.word}}</view>
        <view class="word-phonetic" wx:if="{{currentWord.phonetic}}">[{{currentWord.phonetic}}]</view>
        
        <!-- è¯»éŸ³æ’­æ”¾æŒ‰é’® -->
        <button class="pronunciation-btn-simple {{isPlaying ? 'playing' : ''}}" 
                bindtap="playCurrentWordPronunciation" 
                disabled="{{isPlaying}}">
          <text class="pronunciation-icon">ğŸ”Š</text>
          <text class="pronunciation-text">{{isPlaying ? 'æ’­æ”¾ä¸­...' : 'ç‚¹å‡»å¬å‘éŸ³'}}</text>
        </button>
      </view>

      <!-- å«ä¹‰æ˜¾ç¤º -->
      <view class="word-info-container">
        <view class="word-info-row">
          <view class="word-type" wx:if="{{currentWord.wordType}}">
            <text class="type-label">{{currentWord.wordType === 'noun' ? 'åè¯' : 
                                       currentWord.wordType === 'verb' ? 'åŠ¨è¯' : 
                                       currentWord.wordType === 'adjective' ? 'å½¢å®¹è¯' : 
                                       currentWord.wordType === 'phrase' ? 'çŸ­è¯­' : 'æœªçŸ¥'}}</text>
          </view>
          <view class="word-meaning">{{currentWord.meaning}}</view>
        </view>
      </view>
      
      <!-- è¯æ€§æŒ‡ç¤ºå™¨ -->
      <view class="wordtype-indicator">
        <view class="wordtype {{currentWordType === 0 ? 'active' : ''}}">åè¯</view>
        <view class="wordtype-line"></view>
        <view class="wordtype {{currentWordType === 1 ? 'active' : ''}}">åŠ¨è¯</view>
        <view class="wordtype-line"></view>
        <view class="wordtype {{currentWordType === 2 ? 'active' : ''}}">å½¢å®¹è¯</view>
        <view class="wordtype-line"></view>
        <view class="wordtype {{currentWordType === 3 ? 'active' : ''}}">çŸ­è¯­</view>
      </view>

      <!-- å½“å‰è¯æ€§ä¿¡æ¯ -->
      <view class="wordtype-info">
        <text class="info-text">å½“å‰è®­ç»ƒï¼š{{['åè¯', 'åŠ¨è¯', 'å½¢å®¹è¯', 'çŸ­è¯­'][currentWordType]}}</text>
        <text class="info-text">å•è¯æ•°é‡ï¼š{{wordTypeWords.length}}</text>
      </view>

      <!-- æ··åˆè®­ç»ƒå†…å®¹ -->
      <view class="mixed-content">
        <view class="mixed-title">æ··åˆè®­ç»ƒ</view>
        <view class="options">
          <view class="option {{selectedAnswer===item?'selected':''}} {{choiceCorrect && selectedAnswer===item?'correct':''}} {{choiceCorrect && selectedAnswer===item && item!==currentWord.meaning?'wrong':''}} {{isProcessing?'disabled':''}}"
                wx:for="{{choiceOptions}}" wx:key="*this"
                data-answer="{{item}}" bindtap="{{isProcessing?'':'selectChoice'}}">{{item}}</view>
        </view>
        <view class="mixed-hint">é€‰æ‹©æ­£ç¡®å«ä¹‰æˆ–æ‹¼å†™å•è¯</view>
      </view>

      <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
      <view class="bottom-actions">
        <button class="nav-btn" bindtap="skipWord">è·³è¿‡</button>
        <button class="finish-btn" bindtap="nextWord">ä¸‹ä¸€ä¸ª</button>
      </view>
    </view>
  </view>

  <!-- ====== ç»“æŸé¡µ ====== -->
  <view wx:if="{{phase==='done'}}">
    <view class="word-card">
      <view class="word-main">è®­ç»ƒå®Œæˆ ğŸ‰</view>
      <view class="meaning-text">
        æ­£ç¡®ç‡ {{accuracy}}% Â· å¹³å‡ååº” {{avgTime}}s Â· å·²æ¸…ç©ºåˆ°æœŸ {{cleared}} ä¸ª
      </view>
      <view class="browse-content">
        <button class="finish-btn" bindtap="exportReport">ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š</button>
      </view>
    </view>

    <view class="bottom-actions">
      <button class="nav-btn" bindtap="restartSession">å†æ¥ä¸€èŠ‚</button>
      <button class="finish-btn" bindtap="backHome">è¿”å›é¦–é¡µ</button>
      <button class="nav-btn" bindtap="reviewPlan">æ˜æ—¥åˆ°æœŸ {{tomorrowDue}} è¯</button>
    </view>
  </view>

  <!-- åŠ è½½ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-text">æ­£åœ¨å®‰æ’æœ¬èŠ‚è®­ç»ƒ...</view>
  </view>

</view>

