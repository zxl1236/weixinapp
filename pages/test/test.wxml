<view class="container">
  <!-- è¿›åº¦æ¡ -->
  <view class="progress-section">
    <view class="progress-info">
      <text class="progress-text">
        {{(isTraining || isAssessment) ? currentGradeName + (isAssessment ? ' è¯„ä¼°' : ' è®­ç»ƒ') + ' Â· ' : ''}}ç¬¬ {{currentIndex + 1}} / {{totalQuestions}} é¢˜
      </text>
      <text class="score-text">å¾—åˆ†: {{score}}</text>
    </view>
    <!-- é˜¶æ®µæè¿° -->
    <view class="stage-info" wx:if="{{stageDescription}}">
      <text class="stage-desc">{{stageDescription}}</text>
    </view>
    <view class="progress-container">
      <view class="progress-bar" style="width: {{((currentIndex + 1) / totalQuestions) * 100}};"></view>
    </view>
  </view>

  <!-- é¢˜ç›®å¡ç‰‡ -->
  <view class="card question-card" wx:if="{{currentQuestion}}">
    <view class="question-header">
      <view class="word-level">Level {{currentQuestion.level}}</view>
      <view class="question-word">{{currentQuestion.word}}</view>
      <view class="phonetic" wx:if="{{currentQuestion.phonetic}}">{{currentQuestion.phonetic}}</view>
      <view class="part-of-speech" wx:if="{{currentQuestion.partOfSpeech}}">
        <text class="pos-tag">{{currentQuestion.partOfSpeech}}</text>
      </view>
      <view class="pronunciation-section">
        <button class="pronunciation-btn" bindtap="playPronunciation">
          ğŸ”Š å¬å‘éŸ³
        </button>
      </view>
    </view>
    
    <view class="question-text">è¯·é€‰æ‹©è¿™ä¸ªå•è¯çš„ä¸­æ–‡æ„æ€ï¼š</view>
    
    <!-- é€‰é¡¹åˆ—è¡¨ -->
    <view class="options-container">
      <view 
        class="option {{selectedAnswer === index ? 'selected' : ''}} {{showResult && index === correctIndex ? 'correct' : ''}} {{showResult && selectedAnswer === index && index !== correctIndex ? 'wrong' : ''}}"
        wx:for="{{currentQuestion.options}}" 
        wx:key="index"
        bindtap="selectOption"
        data-index="{{index}}"
      >
        <view class="option-label">{{item}}</view>
        <view class="option-indicator" wx:if="{{showResult && index === correctIndex}}">âœ“</view>
        <view class="option-indicator wrong" wx:if="{{showResult && selectedAnswer === index && index !== correctIndex}}">âœ—</view>
      </view>
    </view>

    <!-- ç­”é¢˜æŒ‰é’® -->
    <view class="action-buttons">
      <button 
        class="btn btn-primary" 
        wx:if="{{!showResult && selectedAnswer !== null}}"
        bindtap="submitAnswer"
      >
        ç¡®è®¤ç­”æ¡ˆ
      </button>
      
      <button 
        class="btn btn-primary" 
        wx:if="{{showResult && currentIndex < totalQuestions - 1}}"
        bindtap="nextQuestion"
      >
        ä¸‹ä¸€é¢˜
      </button>
      
      <button 
        class="btn btn-primary" 
        wx:if="{{showResult && currentIndex === totalQuestions - 1}}"
        bindtap="finishTest"
      >
        æŸ¥çœ‹ç»“æœ
      </button>
    </view>

    <!-- è§£é‡Šè¯´æ˜ - ä»…é”™è¯¯ç­”æ¡ˆæ—¶æ˜¾ç¤º -->
    <view class="explanation" wx:if="{{showResult && !isLastAnswerCorrect}}">
      <view class="explanation-title">è§£æ</view>
      <view class="explanation-text">
        <text class="word-highlight">{{currentQuestion.word}}</text> çš„æ­£ç¡®ä¸­æ–‡æ„æ€æ˜¯ 
        <text class="meaning-highlight">{{currentQuestion.meaning}}</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-text">æ­£åœ¨åŠ è½½é¢˜ç›®...</view>
  </view>
</view>

<!-- é€€å‡ºç¡®è®¤å¼¹çª— -->
<view class="modal-mask" wx:if="{{showExitModal}}" catchtap="hideExitModal">
  <view class="modal-container" catchtap="">
    <view class="modal-header">
      <text class="modal-title">ç¡®è®¤é€€å‡º</text>
    </view>
    <view class="modal-body">
      <text class="modal-text">ç¡®å®šè¦é€€å‡ºæµ‹è¯•å—ï¼Ÿå½“å‰è¿›åº¦å°†ä¼šä¸¢å¤±ã€‚</text>
    </view>
    <view class="modal-footer">
      <button class="btn btn-secondary" bindtap="hideExitModal">ç»§ç»­æµ‹è¯•</button>
      <button class="btn btn-primary" bindtap="confirmExit">ç¡®è®¤é€€å‡º</button>
    </view>
  </view>
</view>