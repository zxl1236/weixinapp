<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³æ’­æ”¾è¯Šæ–­</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .diagnostic-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-item {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .test-btn {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
            font-weight: bold;
        }
        .test-btn:hover {
            background: #357ABD;
        }
        .test-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .voice-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .voice-item {
            padding: 5px;
            margin: 2px 0;
            border-bottom: 1px solid #eee;
            font-family: monospace;
            font-size: 12px;
        }
        .log-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .clear-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”Š è¯­éŸ³æ’­æ”¾è¯Šæ–­å·¥å…·</h1>
    
    <div class="diagnostic-section">
        <h2>ğŸ” ç³»ç»Ÿæ£€æŸ¥</h2>
        <div id="systemCheck"></div>
    </div>
    
    <div class="diagnostic-section">
        <h2>ğŸ¤ å¯ç”¨è¯­éŸ³åˆ—è¡¨</h2>
        <button class="test-btn" onclick="loadVoices()">ğŸ”„ åˆ·æ–°è¯­éŸ³åˆ—è¡¨</button>
        <div id="voicesList"></div>
    </div>
    
    <div class="diagnostic-section">
        <h2>ğŸ§ª åŸºç¡€æµ‹è¯•</h2>
        <button class="test-btn" onclick="testBasicSpeech()">ğŸ”Š åŸºç¡€è¯­éŸ³æµ‹è¯•</button>
        <button class="test-btn" onclick="testEnglishSpeech()">ğŸ‡ºğŸ‡¸ è‹±è¯­è¯­éŸ³æµ‹è¯•</button>
        <button class="test-btn" onclick="testWordList()">ğŸ“ è¯æ±‡åˆ—è¡¨æµ‹è¯•</button>
        <button class="test-btn" onclick="testUserInteraction()">ğŸ‘† ç”¨æˆ·äº¤äº’æµ‹è¯•</button>
    </div>
    
    <div class="diagnostic-section">
        <h2>ğŸ› ï¸ é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2>
        <div id="solutions"></div>
    </div>
    
    <div class="diagnostic-section">
        <h2>ğŸ“‹ å®æ—¶æ—¥å¿—</h2>
        <button class="clear-btn" onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
        <div id="logOutput" class="log-output"></div>
    </div>

    <script src="app.js"></script>
    <script>
        let logOutput = [];
        
        // è‡ªå®šä¹‰æ—¥å¿—å‡½æ•°
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logOutput.push(logEntry);
            
            const logDiv = document.getElementById('logOutput');
            logDiv.textContent = logOutput.join('\n');
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // é‡å†™console.logä»¥æ•è·æ—¥å¿—
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            addLog('LOG: ' + args.join(' '));
            originalLog.apply(console, arguments);
        };
        
        console.error = function(...args) {
            addLog('ERROR: ' + args.join(' '));
            originalError.apply(console, arguments);
        };
        
        console.warn = function(...args) {
            addLog('WARN: ' + args.join(' '));
            originalWarn.apply(console, arguments);
        };
        
        function clearLog() {
            logOutput = [];
            document.getElementById('logOutput').textContent = '';
        }
        
        // ç³»ç»Ÿæ£€æŸ¥
        function checkSystem() {
            const systemDiv = document.getElementById('systemCheck');
            let html = '';
            
            // æ£€æŸ¥åŸºç¡€æ”¯æŒ
            const hasSpeechSynthesis = 'speechSynthesis' in window;
            html += `<div class="status-item ${hasSpeechSynthesis ? 'success' : 'error'}">
                ${hasSpeechSynthesis ? 'âœ…' : 'âŒ'} speechSynthesis API æ”¯æŒ
            </div>`;
            
            if (hasSpeechSynthesis) {
                // æ£€æŸ¥å½“å‰çŠ¶æ€
                html += `<div class="status-item info">
                    ğŸ“Š å½“å‰çŠ¶æ€: speaking=${speechSynthesis.speaking}, pending=${speechSynthesis.pending}, paused=${speechSynthesis.paused}
                </div>`;
                
                // æ£€æŸ¥è¯­éŸ³æ•°é‡
                const voices = speechSynthesis.getVoices();
                html += `<div class="status-item ${voices.length > 0 ? 'success' : 'warning'}">
                    ğŸ™ï¸ å¯ç”¨è¯­éŸ³: ${voices.length} ä¸ª
                </div>`;
            }
            
            // æ£€æŸ¥æµè§ˆå™¨
            const userAgent = navigator.userAgent;
            const isChrome = userAgent.includes('Chrome');
            const isEdge = userAgent.includes('Edg');
            const isFirefox = userAgent.includes('Firefox');
            const isSafari = userAgent.includes('Safari') && !isChrome;
            
            html += `<div class="status-item info">
                ğŸŒ æµè§ˆå™¨: ${isChrome ? 'Chrome' : isEdge ? 'Edge' : isFirefox ? 'Firefox' : isSafari ? 'Safari' : 'å…¶ä»–'}
            </div>`;
            
            // æ£€æŸ¥åè®®
            const isHTTPS = location.protocol === 'https:';
            const isLocalhost = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
            html += `<div class="status-item ${isHTTPS || isLocalhost ? 'success' : 'warning'}">
                ğŸ”’ åè®®: ${location.protocol} ${isHTTPS || isLocalhost ? '(å®‰å…¨)' : '(å¯èƒ½éœ€è¦HTTPS)'}
            </div>`;
            
            systemDiv.innerHTML = html;
        }
        
        // åŠ è½½è¯­éŸ³åˆ—è¡¨
        function loadVoices() {
            addLog('å¼€å§‹åŠ è½½è¯­éŸ³åˆ—è¡¨...');
            
            const voicesDiv = document.getElementById('voicesList');
            
            function displayVoices() {
                const voices = speechSynthesis.getVoices();
                addLog(`æ‰¾åˆ° ${voices.length} ä¸ªè¯­éŸ³`);
                
                if (voices.length === 0) {
                    voicesDiv.innerHTML = '<div class="status-item warning">âš ï¸ æ²¡æœ‰æ‰¾åˆ°å¯ç”¨è¯­éŸ³</div>';
                    return;
                }
                
                let html = `<div class="status-item success">âœ… æ‰¾åˆ° ${voices.length} ä¸ªè¯­éŸ³</div>`;
                html += '<div class="voice-list">';
                
                voices.forEach((voice, index) => {
                    const isEnglish = voice.lang.startsWith('en');
                    html += `<div class="voice-item ${isEnglish ? 'style="background: #e6f3ff;"' : ''}">
                        ${index + 1}. ${voice.name} (${voice.lang}) 
                        ${voice.default ? '[é»˜è®¤]' : ''} 
                        ${voice.localService ? '[æœ¬åœ°]' : '[äº‘ç«¯]'}
                        <button onclick="testVoice('${voice.name}', '${voice.lang}')" style="margin-left: 10px; padding: 2px 8px; font-size: 10px;">æµ‹è¯•</button>
                    </div>`;
                });
                
                html += '</div>';
                voicesDiv.innerHTML = html;
            }
            
            // ç«‹å³å°è¯•è·å–è¯­éŸ³
            displayVoices();
            
            // å¦‚æœæ²¡æœ‰è¯­éŸ³ï¼Œç­‰å¾…åŠ è½½
            if (speechSynthesis.getVoices().length === 0) {
                addLog('è¯­éŸ³åˆ—è¡¨ä¸ºç©ºï¼Œç­‰å¾…åŠ è½½...');
                speechSynthesis.addEventListener('voiceschanged', displayVoices, { once: true });
            }
        }
        
        // æµ‹è¯•ç‰¹å®šè¯­éŸ³
        function testVoice(voiceName, lang) {
            addLog(`æµ‹è¯•è¯­éŸ³: ${voiceName} (${lang})`);
            
            const utterance = new SpeechSynthesisUtterance('Hello world');
            const voices = speechSynthesis.getVoices();
            const voice = voices.find(v => v.name === voiceName);
            
            if (voice) {
                utterance.voice = voice;
            }
            
            utterance.onstart = () => addLog(`âœ… è¯­éŸ³å¼€å§‹: ${voiceName}`);
            utterance.onend = () => addLog(`âœ… è¯­éŸ³ç»“æŸ: ${voiceName}`);
            utterance.onerror = (e) => addLog(`âŒ è¯­éŸ³é”™è¯¯: ${voiceName} - ${e.error}`);
            
            speechSynthesis.speak(utterance);
        }
        
        // åŸºç¡€è¯­éŸ³æµ‹è¯•
        function testBasicSpeech() {
            addLog('å¼€å§‹åŸºç¡€è¯­éŸ³æµ‹è¯•...');
            
            const utterance = new SpeechSynthesisUtterance('Test');
            utterance.volume = 1.0;
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            
            utterance.onstart = () => addLog('âœ… åŸºç¡€æµ‹è¯•å¼€å§‹');
            utterance.onend = () => addLog('âœ… åŸºç¡€æµ‹è¯•ç»“æŸ');
            utterance.onerror = (e) => addLog(`âŒ åŸºç¡€æµ‹è¯•é”™è¯¯: ${e.error}`);
            
            speechSynthesis.speak(utterance);
        }
        
        // è‹±è¯­è¯­éŸ³æµ‹è¯•
        function testEnglishSpeech() {
            addLog('å¼€å§‹è‹±è¯­è¯­éŸ³æµ‹è¯•...');
            
            const utterance = new SpeechSynthesisUtterance('Hello');
            utterance.lang = 'en-US';
            
            // å°è¯•é€‰æ‹©è‹±è¯­è¯­éŸ³
            const voices = speechSynthesis.getVoices();
            const englishVoice = voices.find(voice => voice.lang.startsWith('en'));
            if (englishVoice) {
                utterance.voice = englishVoice;
                addLog(`ä½¿ç”¨è‹±è¯­è¯­éŸ³: ${englishVoice.name}`);
            } else {
                addLog('âš ï¸ æ²¡æœ‰æ‰¾åˆ°è‹±è¯­è¯­éŸ³');
            }
            
            utterance.onstart = () => addLog('âœ… è‹±è¯­æµ‹è¯•å¼€å§‹');
            utterance.onend = () => addLog('âœ… è‹±è¯­æµ‹è¯•ç»“æŸ');
            utterance.onerror = (e) => addLog(`âŒ è‹±è¯­æµ‹è¯•é”™è¯¯: ${e.error}`);
            
            speechSynthesis.speak(utterance);
        }
        
        // è¯æ±‡åˆ—è¡¨æµ‹è¯•
        function testWordList() {
            addLog('å¼€å§‹è¯æ±‡åˆ—è¡¨æµ‹è¯•...');
            
            const words = ['ball', 'cat', 'dog', 'apple', 'book'];
            let index = 0;
            
            function speakNext() {
                if (index >= words.length) {
                    addLog('âœ… è¯æ±‡åˆ—è¡¨æµ‹è¯•å®Œæˆ');
                    return;
                }
                
                const word = words[index];
                addLog(`æ’­æ”¾å•è¯: ${word}`);
                
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                
                utterance.onend = () => {
                    index++;
                    setTimeout(speakNext, 500); // 500msé—´éš”
                };
                
                utterance.onerror = (e) => {
                    addLog(`âŒ æ’­æ”¾å¤±è´¥: ${word} - ${e.error}`);
                    index++;
                    setTimeout(speakNext, 500);
                };
                
                speechSynthesis.speak(utterance);
            }
            
            speakNext();
        }
        
        // ç”¨æˆ·äº¤äº’æµ‹è¯•
        function testUserInteraction() {
            addLog('å¼€å§‹ç”¨æˆ·äº¤äº’æµ‹è¯•...');
            
            // æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»
            const testWords = ['astronaut', 'banana', 'computer'];
            
            testWords.forEach((word, index) => {
                setTimeout(() => {
                    addLog(`æ¨¡æ‹Ÿæ’­æ”¾: ${word}`);
                    if (typeof playPronunciation === 'function') {
                        playPronunciation(word);
                    } else {
                        addLog('âŒ playPronunciation å‡½æ•°ä¸å­˜åœ¨');
                    }
                }, index * 2000);
            });
        }
        
        // æ˜¾ç¤ºè§£å†³æ–¹æ¡ˆ
        function showSolutions() {
            const solutionsDiv = document.getElementById('solutions');
            
            const solutions = [
                {
                    title: 'ğŸ”§ å¸¸è§è§£å†³æ–¹æ¡ˆ',
                    items: [
                        'ç¡®ä¿ä½¿ç”¨ Chrome æˆ– Edge æµè§ˆå™¨ï¼ˆFirefox å’Œ Safari æ”¯æŒæœ‰é™ï¼‰',
                        'æ£€æŸ¥æµè§ˆå™¨éŸ³é‡è®¾ç½®ï¼Œç¡®ä¿æ²¡æœ‰é™éŸ³',
                        'åœ¨ HTTPS ç¯å¢ƒä¸‹ä½¿ç”¨ï¼ˆæŸäº›æµè§ˆå™¨è¦æ±‚ï¼‰',
                        'ç¡®ä¿ç³»ç»Ÿæœ‰å¯ç”¨çš„è¯­éŸ³å¼•æ“'
                    ]
                },
                {
                    title: 'ğŸ” Windows ç³»ç»Ÿæ£€æŸ¥',
                    items: [
                        'æ‰“å¼€"è®¾ç½®" > "æ—¶é—´å’Œè¯­è¨€" > "è¯­éŸ³"',
                        'ç¡®ä¿å®‰è£…äº†è‹±è¯­è¯­éŸ³åŒ…',
                        'å°è¯•åœ¨"è®²è¿°äºº"ä¸­æµ‹è¯•è¯­éŸ³',
                        'é‡å¯æµè§ˆå™¨åå†è¯•'
                    ]
                },
                {
                    title: 'ğŸ” Mac ç³»ç»Ÿæ£€æŸ¥',
                    items: [
                        'æ‰“å¼€"ç³»ç»Ÿåå¥½è®¾ç½®" > "è¾…åŠ©åŠŸèƒ½" > "è¯­éŸ³"',
                        'ç¡®ä¿æœ‰è‹±è¯­è¯­éŸ³å¯ç”¨',
                        'å°è¯•åœ¨"æ–‡æœ¬è½¬è¯­éŸ³"ä¸­æµ‹è¯•',
                        'æ£€æŸ¥éŸ³é¢‘è¾“å‡ºè®¾å¤‡'
                    ]
                },
                {
                    title: 'ğŸ”§ Chrome ç‰¹å®šè§£å†³æ–¹æ¡ˆ',
                    items: [
                        'åœ°å€æ è¾“å…¥ chrome://settings/content/sound',
                        'ç¡®ä¿å…è®¸ç½‘ç«™æ’­æ”¾å£°éŸ³',
                        'æ£€æŸ¥ç½‘ç«™æƒé™è®¾ç½®',
                        'å°è¯•åˆ·æ–°é¡µé¢åå†è¯•'
                    ]
                }
            ];
            
            let html = '';
            solutions.forEach(section => {
                html += `<div class="status-item info">
                    <strong>${section.title}</strong>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        ${section.items.map(item => `<li style="margin: 5px 0;">${item}</li>`).join('')}
                    </ul>
                </div>`;
            });
            
            solutionsDiv.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            addLog('è¯­éŸ³è¯Šæ–­å·¥å…·åŠ è½½å®Œæˆ');
            checkSystem();
            loadVoices();
            showSolutions();
            
            // æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡çŠ¶æ€
            setInterval(() => {
                if (speechSynthesis.speaking) {
                    addLog('ğŸµ æ­£åœ¨æ’­æ”¾è¯­éŸ³...');
                }
            }, 5000);
        });
    </script>
</body>
</html>